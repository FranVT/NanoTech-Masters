\documentclass[../../main-notes.tex]{subfiles}

\begin{document}

\section{Theoretical framework}

\subsection{Brownian dynamics}

Here explain the Langevin equation.

\subsection{Stress}

\paragraph{Introductory paragraph} To characterize the behaviour of materials, constitutive relations serve as an input to the continuum theory\dots\footnote{Capaz e ir introduciendo ideas del Clausius\citep{clausiusXVIMechanicalTheorem1870}}

This derivation can be found in the apendix of\citep{admalUnifiedInterpretationStress2010}\footnote{Describe more if what is done in this article}.
Consider a system of $N$ interacting particles with each particle position given by
\begin{equation}
    \vec{r}_{\alpha} = \vec{r} + \vec{s}_{\alpha}\label{eqn:DerVirTen1},
\end{equation}
where $\vec{r}$ is the position of the center of mass of the system and $\vec{s}_\alpha$ is the position of each point relative to the center of mass.
Hence, we can express the momentum of each particle as
\begin{equation}
    \vec{p}_\alpha = m_\alpha\qty(\dot{\vec{r}}+\dot{\vec{s}}_\alpha) = m_\alpha\qty(\dot{\vec{r}}+\vec{\upsilon}_\alpha^{\mathrm{rel}}).\label{eqn:DerVirTen2}
\end{equation}
Before starting the procedure, lets take into account that the center of mass of the system is given by
\begin{equation}
    \vec{r} = \frac{\sum_{\alpha}m_\alpha\vec{s}_\alpha}{\sum_{\alpha}m_\alpha}\label{eqn:DerVirTen3},
\end{equation}
and by replacing~\eqref{eqn:DerVirTen1} in~\eqref{eqn:DerVirTen2} we get the following relations, which will be used later,
\begin{equation}
    \sum_\alpha m_\alpha\vec{r}_\alpha = \vec{0},\quad
    \sum_\alpha m_\alpha\vec{\upsilon}_\alpha^{\mathrm{rel}} = \vec{0}.\label{eqn:DerVirTen4}
\end{equation}

Now we can start by computing the time derivative of tensorial product $\vec{r}_\alpha\otimes\vec{p}_\alpha$\footnote{It is interesting to note that the tensorial product $\vec{r}_\alpha\otimes\vec{p}_\alpha$ has units of action and by tacking the time derivative we are dealing with terms that has units of energy.
},
\begin{equation}
    \dv{t}\qty(\vec{r}_\alpha\otimes\vec{p}_\alpha) = 
    \underbrace{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{p}_\alpha}_{\mathrm{Kinetic~term}} 
        +
        \underbrace{\vec{r}_\alpha\otimes\vec{f}_\alpha}_{\mathrm{Virial~term}},\label{eqn:DerVirTen5}
\end{equation}
which is known as the \textit{dynamical tensor virial theorem} and it is simply an alternative form to express the balance of linear momentum.
This theorem becomes useful after making the assumption that there existis a time scale $\tau$, which is short relative to macroscopic processes but long relative to the characteristic time of the particles in the system, over which the particles remain close to their original positions with bounded positions and velocities.
Taking advantage of this property we can compute the time average of~\eqref{eqn:DerVirTen5},
\begin{equation}
    \frac{1}{\tau}\left.\qty(\vec{r}_\alpha\otimes\vec{p}_\alpha)\right\bigg|_{0}^{\tau} = 
    \overline{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{p}_\alpha} 
        +
    \overline{\vec{r}_\alpha\otimes\vec{f}_\alpha}.\label{eqn:DerVirTen6}
\end{equation}
Assuming that $\vec{r}_\alpha\otimes\vec{p}_\alpha$ is bounded, and the time scales between microscopic and continuum processes are large enough, the term on the left-hand side can be as small as desired by tacking $\tau$ sufficiently large and by summing over all particles we achieve the \textit{tensor virial theorem}:
\begin{equation}
    \overline{\bold{W}} = -2\overline{\bold{T}},\label{eqn:DerVirTen7}
\end{equation}
where
\begin{equation}
    \overline{\bold{W}} = \sum_\alpha\overline{\vec{r}_\alpha\otimes\vec{f}_\alpha}\label{eqn:DerVirTen8}
\end{equation}
is the time-average virial tensor and
\begin{equation}
    \overline{\bold{T}}=\frac{1}{2}\sum_\alpha\overline{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{p}_\alpha}\label{eqn:DerVirTen9}
\end{equation}
is the time-average kinetic tensor.
This expression for the tensor virial theorem applies equally to continuum systems that are not in macroscopic equilibrium as well as those that are at rest.

The assumption of the difference between the time scales allow us to simplify the relation by replacing~\eqref{eqn:DerVirTen2} in~\eqref{eqn:DerVirTen9}, so that,
\begin{equation}
    \overline{\bold{T}}=
        \frac{1}{2}\sum_\alpha m_\alpha\overline{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{v}_\alpha^{\mathrm{rel}}}
        +
        \frac{1}{2} \left[\overline{\sum_\alpha m_\alpha\vec{\upsilon}_\alpha^{\mathrm{rel}}}\right]\otimes\dot{\vec{r}}\label{eqn:DerVirTen10},
\end{equation}
which is not the simplification we expected, however, by the relations from~\eqref{eqn:DerVirTen4}, equation~\eqref{eqn:DerVirTen10} simplifies to\footnote{No estoy muy seguro si incluir una discusión acerca del término cinético en la expresión del virial. Posiblemente un párrafo\dots posiblemente lo ponga en la interpretación del teorema.
También, no se si ir metiendo interpretación durante la derivación o no, pero bueno.}
\begin{equation}
    \overline{\bold{T}}=
        \frac{1}{2}\sum_\alpha m_\alpha\overline{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{\upsilon}_\alpha^{\mathrm{rel}}}\label{eqn:DerVirTen11}.
\end{equation}
On the other hand, instead of reducing the expression, we start to create the conection with the Cauchy stress tensor by distributing~\eqref{eqn:DerVirTen8} into an internal and external contributions,
\begin{equation}
    \overline{\bold{W}} = 
    \underbrace{\sum_\alpha\overline{\vec{r}_\alpha\otimes\vec{f}_\alpha^{\mathrm{int}}}}_{\overline{\bold{W}}_{\mathrm{int}}}
        +
        \underbrace{\sum_\alpha\overline{\vec{r}_\alpha\otimes\vec{f}_\alpha^{\mathrm{ext}}}}_{\overline{\bold{W}}_{\mathrm{ext}}}.\label{eqn:DerVirTen12}
\end{equation}
The time-average internal virial tensor takes into account the interaction between particle $\alpha$ with the other particles in the system, meanwhile, the time-average external virial tensor considers the interaction with atoms outside the system, via a traction vector $\vec{t}$ and external fields acting on the system represented by $\rho\vec{b}$, where $\rho$ is the mass density of it and $\vec{b}$ is the body force per unit mass applied by the external field.
Therefore we can express the following,
\begin{equation}
    \sum_\alpha\overline{\vec{r}_\alpha\otimes\vec{f}_\alpha^{\mathrm{ext}}}
    :=
    \int_{\delta\Omega}\vec{\xi}\otimes\vec{t}dA 
    +
    \int_{\Omega}\vec{\xi}\otimes\rho\vec{b}dV.\label{eqn:DerVirTen13}
\end{equation}
Where $\vec{\xi}$ is a position vector within the domain $\Omega$ occupied by the system of particles with a continuous closed surface $\delta\Omega$.
Assuming that $\Omega$ is large enough to express the external forces acting on it in the form of the continuum traction vector $\vec{t}$.

With this we can substitute the traction vector with $\vec{t}=\bm{\sigma}\vec{n}$, where $\bm{\sigma}$ represent the Cauchy stress tensor and applying the divergence theorem in~\eqref{eqn:DerVirTen13}, we have 
\begin{equation}
    \overline{\bold{W}}_{\mathrm{ext}}
     =\int_{\Omega}
        \left[
            \vec{\xi}\otimes\rho\vec{b}+\mathrm{div}_{\vec{\xi}}\qty(\vec{\xi}\otimes\bm{\sigma})
        \right]dV
        =
    \int_{\Omega}
        \left[
            \bm{\sigma}^{\mathrm{T}}
            +
            \vec{\xi}\otimes\qty(\mathrm{div}_{\vec{\xi}}\bm{\sigma}+\rho\vec{b})
        \right]dV\label{eqn:DerVirTen14}
\end{equation}
Since we assume that we are under equilibrium conditions, the term $\mathrm{div}_{\vec{\xi}}\bm{\sigma}+\rho\vec{b}$ is zero~\eqref{eqn:DerVirTen14} it simplifies to
\begin{equation}
    \overline{\bold{W}}_{\mathrm{ext}}
    =V\bm{\sigma}^{\mathrm{T}}\label{eqn:DerVirTen15}.
\end{equation}
By tacking into account that we integrate over the domain $\Omega$ we can say that we compute the spatial average of the Cauchy stress tensor,
\begin{equation}
    \bm{\sigma}_{\mathrm{av}} =\frac{1}{V}\int_\Omega\bm{\sigma}dV\label{eqn:DerVirTen16},
\end{equation}
in which $V$ is the volume of the domain $\Omega$.
Replacing~\eqref{eqn:DerVirTen15} into~\eqref{eqn:DerVirTen12}, the tensor virial theorem~\eqref{eqn:DerVirTen7} can be expressed as,
\begin{equation}
    \sum_\alpha\overline{\vec{r}_\alpha\otimes\vec{f}_\alpha^{\mathrm{int}}}
    +
    V\bm{\sigma}_{\mathrm{av}}^{\mathrm{T}}
    =
    -\sum_\alpha m_\alpha\overline{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{\upsilon}_\alpha^{\mathrm{rel}}}.\label{eqn:DerVirTen17}
\end{equation}
Finally, solving for the Cauchy Stress tensor we get,
\begin{equation}
    \bm{\sigma}_{\mathrm{av}}
    =
    -\frac{1}{V}
    \left[
        \sum_\alpha\overline{\vec{f}_\alpha^{\mathrm{int}}\otimes\vec{r}_\alpha}
        +
        \sum_\alpha m_\alpha\overline{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{\upsilon}_\alpha^{\mathrm{rel}}}
    \right],\label{eqn:DerVirTen18}
\end{equation}
an expression that describe the macroscopic stress tensor in terms of microscopic variables\footnote{It is important to acknowledge that several mathematical subtleties were not taken into consideration, however all the mathematical formality is adressed by Nikhil Chandra Admal and E. B. Tadmor in~\citep{admalUnifiedInterpretationStress2010}}.

To end the section it is important to show that~\eqref{eqn:DerVirTen18} is symmetric.
Therefore, we rewrite the internal force as the sum of forces between the particles,
\begin{equation}
    \vec{f}^{\mathrm{int}}_\alpha = \sum_{{\beta}_{\beta\neq\alpha}}\vec{f}_{\alpha\beta}\label{eqn:DerVirTen19},
\end{equation}
and substituting~\eqref{eqn:DerVirTen19} into~\eqref{eqn:DerVirTen18}, we have
\begin{equation}
    \bm{\sigma}_{\mathrm{av}}
    =
    -\frac{1}{V}
    \left[
        \sum_{{\alpha,\beta}_{\beta\neq\alpha}}\overline{\vec{f}_{\alpha\beta}\otimes\vec{r}_\alpha}
        +
        \sum_\alpha m_\alpha\overline{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{\upsilon}_\alpha^{\mathrm{rel}}}
    \right].\label{eqn:DerVirTen20}
\end{equation}
Due to the property $\vec{f}_{\alpha\beta}=-\vec{f}_{\beta\alpha}$ we obtain the following identity
\begin{equation}
    \sum_{{\alpha,\beta}_{\beta\neq\alpha}}\vec{f}_{\alpha\beta}\otimes\vec{r}_\alpha 
    =
    \frac{1}{2}\sum_{{\alpha,\beta}_{\beta\neq\alpha}}\left(\vec{f}_{\alpha\beta}\otimes\vec{r}_\alpha+\vec{f}_{\beta\alpha}\otimes\vec{r}_\beta\right)
    =
    \frac{1}{2}\sum_{{\alpha,\beta}_{\beta\neq\alpha}}\vec{f}_{\alpha\beta}\otimes\left(\vec{r}_\alpha-\vec{r}_\beta\right).\label{eqn:DerVirTen21}
\end{equation}
Therefore, by replacing the identity of~\eqref{eqn:DerVirTen21} into~\eqref{eqn:DerVirTen20}, we have
\begin{equation}
    \bm{\sigma}_{\mathrm{av}}
    =
    -\frac{1}{V}
    \left[
        \frac{1}{2}
        \sum_{{\alpha,\beta}_{\beta\neq\alpha}}\overline{\vec{f}_{\alpha\beta}\otimes\left(\vec{r}_\alpha-\vec{r}_\beta\right)}
        +
        \sum_\alpha m_\alpha\overline{\vec{\upsilon}_\alpha^{\mathrm{rel}}\otimes\vec{\upsilon}_\alpha^{\mathrm{rel}}}
    \right],\label{eqn:DerVirTen22}
\end{equation}
expressed with indexical notation and using the eistein summation convention,
\begin{equation}
    \sigma^{\mathrm{av}}_{ij}
    =
    -\frac{1}{V}
    \left[
        \frac{1}{2}
        \sum_{{\alpha,\beta}_{\beta\neq\alpha}}\overline{f^{\alpha\beta}_{i}r^\alpha_{j} + f^{\beta\alpha}_{i}r^\beta_{j}}
        +
        \sum_\alpha m_\alpha\overline{\upsilon^{\alpha~\mathrm{rel}}_{i}\upsilon^{\alpha{\mathrm{rel}}}_j}
    \right],\label{eqn:DerVirTen23}
\end{equation}
which is the same expression implemented in~LAMMPS\citep{LAMMPS}.\footnote{No se si poner la referencia a la pagina de documentacion\href{https://docs.lammps.org/compute_stress_atom.html}{https://docs.lammps.org/compute\_stress\_atom.html}}


\noindent\rule{2cm}{0.4pt}

\subsection{Virial Stress and Cauchy stress}


Main articles for this section:
\begin{itemize}
    \item On mechanical theorem application to heat
    \item The virial theorem and stress calculation in molecular dynamics 
    \item General formulation of pressure and stress tensor for arbitrary many-body interaction potentials under periodic boundary conditions
\end{itemize}

The virial stress developed on the virial theorem of Clausis 1870 and Maxwell 1870 is 
\begin{gather}
    \sigma_{ij}^V = \frac{1}{V}\sum_\alpha\qty[\frac{1}{2}\sum_{\beta=1}^N\qty(R_i^\beta-R^\alpha_i)F^{\alpha\beta}_j-m^\alpha v_i^\alpha v_j^\alpha]\label{eqn-mdStress},
\end{gather}
where $(i,j)$ represents the directions $x$, $y$ and $z$.
$\beta$ goes from $1$ to $N$ representing the neighbors of the particle with index $\alpha$.
Therefore, $R^\alpha_i$ is the position of the particle $alpha$ along the direction $i$, meanwhile $F^{\alpha\beta}_j$ is the force on particle $\alpha$ due to the interaction with particle $\beta$ in the $j$ direction.
Finally, $V$ is the total vovlume of the system, $m^\alpha$ is the mass of the particle $\alpha$ and $v^\alpha_i$ is the velocity of the particle $\alpha$ in direction $i$.
It is important to acknowledge that the force $F^{\alpha\beta}_j$ is uniquely defined only for pair potentials and EAM type potentials.\footnote{So\ldots I need to check\citep{Swenson_1983} and\citep{Tsai_1979} to understand how we get that expression from the virial theorem. Also, I don't know what is the virial theorem  }


The virial stress calculated from molecular dynamics (MD) simulations has to be averaged voer time in order for it to be equivalent to the continuum Cauchy stress\citep{Subramaniyan_Sun_2008}.

Viriral stress is indeed an atomistic definition for stress that is equivalent to the continuum Cauchy stress.


Molecular dynamics simulations are typically performed in the Eulerian reference frame\footnote{I don't know what is the defference between the Langrangian framework and the Eulerian reference frame.} and hence will need to have velocity included in the stress definition.

\subsection{Pressure and stress relation}

Pressure and stress are familiar physicla notions. 
Both refer to the force per unit area which two bodies in contact, or two parts of a single body separated by an imaginary plane, exert on one another.
Both tensorial quantities\citep{Tsai_1979}.
Under hydrostatic conditions, the relationship between external pressure and internal stress is particurlarly simple:
\begin{gather}
    P = \frac{1}{3}\qty(\sigma_{xx}+\sigma_{yy}+\sigma_{zz}),
\end{gather}
where $\sigma_{xx}=\sigma_{yy}=\sigma_{zz}$ and $\sigma_{xy}=\sigma_{yz}=\sigma_{zx}=0$, that is, at equilibirum, the external pressure $P$ is equal to the internal normal stress components and throught the system, the shear components being zero.
Under these conditions, the external pressure may be calculated from the virial theorem:
\begin{gather}
    PV = NkT-\frac{1}{3}\left\langle\sum_{i,j<1}^N\vec{r}_{ij}\cdot\pdv{\Phi_{ij}}{r_{ij}}\right\rangle,
\end{gather}
where $V$ is the volume, $N$ is the number of particles, $T$ is the tmeperature of the system, $k$ is the Boltzmann's constante, $r_{ij}$  is the vector joining particles $i$ and $j$ and $\Phi_{ij}$ is the interatomic potential between $i$ and $j$.
The angular brackets denote average over time\footnote{Is the same expression for the scalar pressure used by the compute pressure in lammps: \href{https://docs.lammps.org/compute_pressure.html}{documentation page}.}.

The instantaneous internal stress ar a point is made up of two parts:
\begin{itemize}
    \item The sum of the interatomic forces intercepted by a small area containing the point, averaged over the area.
    \item The momentum flux through this area during a time interval $\Delta t$
\end{itemize}
If an atom moves across the area, carrying momentum $\Delta mv$, then the area also ``feels'' a force equal to the momentum flux $\Delta mv/\Delta t$, and the force also contributes to the stress over the area in the interval $\Delta t$.
The normal component of the sum of the forces gives the normal stress, and the in-plane component gives the tangential stress.
The area may be either stationary or moving at a uniform velocity.
It may also be at the boundary of the system.

The time averages of the instantaneous stress components then ive what may be called the ``measured'' stresses at the point.\citep{Tsai_1979}.
\ldots
This formulation is not new: Cauchy discussed the stress-strain relationship in a crystalline material from the viewpoint of ``region of molecular activity'' as early as 1828.
\ldots
The stress method applies equally to a system not in thermal equilibrium, because the temperature term does not appear explicitly in this formulation.
\ldots
the method of stress calculation may be applied locally, without requiring the system to be in equilibrium or even spatially homogeneous.
\ldots
it should be possible to use this method to obtain the stress distribution in a solid with a crack in it, whereas the virial method would be inapplicable in this case.

They show that the pressure calculated by the vrial method is actually the normal stress in the boundary planes.
The stress method, on the other hand, can be used to calculated the stress not only in the boundary planes, but also in the interior planes.

The virial is defined as 
\begin{gather}
    \Upsilon=\sum_i^N \vec{r}\cdot\vec{F}_i,
\end{gather}


\subsection{Lammps implementation}

\paragraph{Langevin Thermostat}

\paragraph{compute stress/atom and pressure}\footnote{Explain the scalar pressure, pressure tensor and stress tensor. Explain the relation between pressure and stress of the system.}

Virial contribution to the stress and pressure tensors\citep{Thompson_Plimpton_Mattson_2009}.
They find three ways of computing the virial contribution,
\begin{align}
    W(\vec{r}^N) &= \sum_{k\in\vec{0}}\sum_{w=1}^{N_k} \vec{r}^k_{w}\cdot\vec{F}^k_{w} \\
    W(\vec{r}^N) &= \sum_{n\in Z^3}\sum_{i=1}^N \vec{r}_{i\vec{n}}\cdot\left(
    -\sum_{k\in\vec{0}}\dv{\vec{r}_{i\vec{n}}}u_k\qty(\vec{r}^{N_k})\right) \\
        W(\vec{r}^N) &= \sum_{n\in Z^3}\sum_{i=1}^N \vec{r}_{i}\cdot\vec{F}_i 
    +\sum_{\vec{n}\in Z^3}\vec{\mathrm{Hn}}\cdot\sum_{i=1}^N\left(
    -\sum_{k\in\vec{0}}\dv{\vec{r}_{i\vec{n}}}u_k\qty(\vec{r}^{N_k})\right)
\end{align}
\footnote{Skimming the equations \eqref{eqn-mdStress} and that one, the virial term are similars. Need to check if they are equivalents. }





\begin{comment}
Stress is an important concept in characterizong the states of condensed matter.
A body is in a state of stress if it is acted upon by external force or, more generally, if one part of the body exerts forces upon another part.
If we consider a volume element within a stressed body, we can distinguish the effect of two types of forces: those acting directly in the interior of the element and those exerted upon the surface of the element by the surrounding material.
The latter forces (per unit area) are stress that are transmitted throught the interior of the volume.
For condensed matter in which the stress is homogeneous in volumes of macroscopic dimensions, the equation of state in the relation between the stress and the internal variables, such as the density and temperature.\footnote{Cite Quantum-mechanical theory of stress and force}

In order to describe general flow gradients, the velocity gradient tensor, the deformation tensor and the stress tensor are mathematical entities that help in doing so.
The velocity gradient tensor describes the steepness of velocity variation as one moves from point to point in any direction in the flow at a given instant in time.
The deformation gradient tensor describe the deformation history in a complex fluid.
Lastly, the stress tensor represent the force per unit area that is exert on a surface.\footnote{Cite Larson Book Introduction to Complex Fluids}

In general the stress tensor is modeled with two terms,
\begin{equation}
    \vb{T} = \vb{\sigma} - p\vb{\delta}\label{eqn:generalStressTensor}.
\end{equation}
where $\vb{\sigma}$ represent the stress tensor related to internal phenomena of the system and the second term consider external pressure to the system, more specifically, the atmospheric pressure.
\dots since we are interested in the response of the material our analysis will be center in $\vb \sigma$
\dots
To do it so, we analyze the virial stress to find the macroscopic (contoniuum) stress, because we are going to use molecular dynamics computations\footnote{Cite Physical Interpretation of the virial stress}.
The macroscopic stress tensor in a macroscopically small volume $\Omega$  is typically taken to be:
\begin{equation}
    \sigma_{\alpha\beta} = \frac{1}{\Omega}\sum_{i\in\Omega}\left(\frac{1}{2}\sum_{j}\qty(x_\alpha^{(j)}-x_\alpha^{(i)})f_{\beta}^{(ij)} -m^{(i)}\qty(u^{(i)}_\alpha - \bar{u}_\alpha)\qty(u^{(i)}_\beta - \bar{u}_\beta)\right)\label{eqn:macroStressTensor}
\end{equation}
where\dots $\alpha,\beta$ are $x,y,z$\dots.
\dots to reduce random fluctuations (because we are using Brownian dynamics) we perfom a spatial and time average.
The $1/\Omega$ factor is due to the spatial average, meanwhile the time average are the terms in equation~\eqref{eqn:macroStressTensor}.
The first term emerges from the virial theorem of Clasius, and the second term is a correction ter that emerges from the ``cross-over'' phenomena, when analyzing at microscopic scale.\footnote{Explain more}
\end{comment}


\end{document}
